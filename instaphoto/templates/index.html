{%extends 'base.html'%}
{% load humanize %}

{%block content%}
{{block.super}}
<div class="container-fluid row">
    <div class="col-2"></div>
    <div class="card mt-4 py-3 col-8">
        <form enctype="multipart/form-data" method="POST" action="" class="d-inline-flex">
            {% csrf_token %}
            {% for field in form1 %}
            <div class="form-control ">
                <!-- Omit the label tag here -->
                {{ field }}
            </div>
            {% endfor %}
            <input type="submit" class='btn btn-warning' value="Upload" />
        </form>
    </div>
    <div class="col-2"></div>
</div>

<div class="container">
    <div class="row">
        <div class="col-sm-3"></div>

        <div class="col-sm-6">
            {%for post in posts%}
            <div class="card my-3">
                <div class="card-header">


                    {%if post.user.profile.profile_photo%}
                    <div class="d-inline-flex">
                        <img class="rounded-circle" src="{{post.user.profile.profile_photo.url}}"
                            style="height:70px;width: 70px;" alt="No profile pic">
                        <div class="mt-3">
                            <p class="m-0">{{post.user.username | title}}</p>
                            <p style="color:gray;" class="m-0">{{post.pub_date | naturaltime}}</p>
                        </div>


                    </div>
                    <p class="mb-0">{{post.caption}}</p>

                    {%else%}

                    <a class="fa fa-user fa-3x" style="margin-top:1%"><span style="font-size:19px;">{{post.user.username
                            | title}}</span></a>
                    {%endif%}

                </div>

                <div class="card-body text-center">
                    <img class="img-fluid" src="{{post.post_image.url}}" style="height: 200px; width: 90%;"
                        type="button" class="btn btn-sm btn-outline-primary" id="post{{post.id}}"
                        data-whatever="{{post.id}}" data-toggle="modal" data-target="#extraModal{{post.id}}">
                </div>

                <div class="card-footer bg-white">
                    <!-- <p><strong>{{post.user.username}}</strong> {{post.caption}}</p>
                    <p style="font-size: 20px;color:gray;">{{post.pub_date | naturaltime}}</p> -->
                    <strong>Comments:</strong>
                    {% for comment in comments %}
                    {%if post.id == comment.post.id%}
                    <p class="my-0"><strong>{{comment.user.username}}</strong> {{comment.comment | title}}</p>
                    {%endif%}
                    {% endfor %}

                    <form method="post" style="margin-top: 1.3em;" class="d-inline-flex justify-content-between">
                        {{form.comment}}
                        {% csrf_token %}
                        <input type="hidden" value="{{post.id}}" name="post_id" />
                        <button type="submit" class="btn btn-warning">Comment</button>
                    </form>
                </div>

            </div>

            {%endfor%}
        </div>

        <div class="col-sm-3"></div>
    </div>

    {% for post in posts %}

    <div class="modal fade" id="extraModal{{post.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <button type="button" class="close text-danger" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">

            <div class="modal-content ">


                <div class="modal-body row" style="padding:0;">
                    <img style="height: 500px;padding:0;margin: 0;" id="image" class=" col-12 col-md-7 text-center"
                        src='{{post.post_image.url}}'>

                    <div class=" col-12 col-md-5 card">
                        <div class="card-header bg-white">
                            <p><span>Posted by:
                                </span><strong>{{post.user.username| title}}</strong></p>
                            <p><span>Caption:
                                </span>{{post.caption}}</p>

                        </div>

                        <div class="card-body">
                            {% for comment in comments %}
                            {%if post.id == comment.post.id%}
                            <p><strong>{{comment.user.username}}</strong> {{comment.comment | title}} <span
                                    style="font-size: 10px;color:gray;">{{comment.pub_date | naturaltime}}</span></p>
                            {%endif%}
                            {% endfor %}
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>
    {%endfor%}
</div>

{%endblock%}